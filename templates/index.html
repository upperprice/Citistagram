<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="UTF-8">
    <title>Citistagram</title>
    <link rel="icon" href="../static/img/symbol.png" type="image/ico">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link
        href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=East+Sea+Dokdo&family=Gugi&family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Noto+Serif+KR:wght@300;500;600;900&family=Stylish&family=Yeon+Sung&display=swap"
        rel="stylesheet">

    <!-- Optional JavaScript -->

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://use.fortawesome.com/99966411.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <!-- main css -->
    <link rel="stylesheet" href="../static/style.css">
    <link rel="stylesheet" href="../static/responsive.css">
    <script src="/static/script.js"></script>
    <script>
        $(document).ready(function () {
            get_data()
        });
    </script>

</head>

<body>
    <!--================1.Navbar파트====================-->
    <header class="header">
        <nav class="navbar">
            <div class="navbar_logo_box">
                <a class="navbar-brand logo_h" href="/">
                    <img width="100px" class="img_logo"
                        src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdfHEoS%2FbtrBLGSukaH%2FRRvZyVhJqHQm4ojqMunP40%2Fimg.png"
                        alt="로고 이미지">
                </a>
            </div>
            <div class="navbar_search_box">
                <form class="d-flex">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                </form>
            </div>
            <div class="navbar_links_box">
                <ul class="navbar_links">
                    <li><a href="/"><i class="fa fa-home-fi"></i></a></li>
                    <li><a href="/dm_page"><i class="fa fa-paper-plane" style="width:28px"></i></a></li>
                    <li><button id="nav_bar_add_box" class="modal_button" data-toggle="modal"
                            data-target="#addition_modal_box"><i class="fa fa-plus"></i></button></li>
                    <li><a href=""><i class="fa fa-compass"></i></a></li>
                    <li><button id="navbar_heart" class="modal_button"><i class="fa fa-heart"></i></button></li>
                    <li style="display: flex; align-items: center;"><button
                            style="width: 70px; height: 30px; font-size: 15px; cursor: pointer; border: 0;"
                            onclick="logout()">logout</button></li>
                </ul>
            </div>
            <!--더하기 버튼 모달(새게시물 만들기)//첫번째-->
            <div id="first_modal" class="modal_overlay">
                <div class="modal_window">
                    <div class="addition_modal_head">
                        <div style="width:40px"></div>
                        <p class="modal-title">새 게시물 만들기</p>
                        <button id="modal_x_box" class="modal_x_box"><i class="fa fa-x"></i></button>
                    </div>
                    <div id="image_upload" class="addition_modal_body">
                        사진을 여기에 끌어다 놓으세요

                    </div>
                </div>
            </div>
            <!--더하기 버튼 모달(새게시물 만들기)//두번째-->
            <div id="second_modal" class="modal_overlay">
                <div class="modal_window2">
                    <div class="addition_modal_head">
                        새 게시물 만들기
                        <button id="modal_x_box2" class="modal_x_box"><i class="fa fa-x"></i></button>
                    </div>
                    <div class="addition_modal_body2">
                        <div class="img_upload_space"></div>
                        <div class="img_description_space">
                            <div class="img_description_box">
                                <textarea id="input_feed_content" style="width:100%;height: 100%"
                                    placeholder="내용을 써주세요^^"></textarea>
                            </div>
                            <div style="justify-content: center;display: flex">
                                <button id="feed_create_button" onclick="uploading_files()"
                                    style="background-color: transparent; border-color: #C7B0FFFF; color: #C7B0FFFF;width:100px;border-radius: 5px ">Submit</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--하트:tooltip-->
            <div id="heart_tooltip" class="heart_tooltip">
            </div>
        </nav>
    </header>


    <!--================1.Navbar END====================-->

    <!--================2.메인 카드 섹션==================-->
    <main class="">
        <div class="main_page_all">
            <div class="main_column">
                <div class="first_bar">
                    <div class="other_menus">
                        <span></span>
                        <div>
                            <img width="70px" src="../static/img/리스트1.png" alt="">
                            <p>Music</p>
                        </div>
                        <div>
                            <img width="70px" src="../static/img/리스트2.png" alt="">
                            <p>City</p>
                        </div>
                        <div>
                            <img width="70px" src="../static/img/리스트3.png" alt="">
                            <p>Skyline</p>
                        </div>
                        <div>
                            <img width="70px" src="../static/img/리스트4.png" alt="">
                            <p>Drive</p>
                        </div>
                        <span></span>
                    </div>
                </div>
                {% for content in contents %}
                <div id="card_box" class="card_box">
                    <div class="card_top">
                        <div class="profile">
                            <a class="profile_pic_box" href="{{url_for('profile_page', user_id=content.user_id)}}"><img
                                    class="profile_pic" style="width: 100%;" src="../static/img/profiles/{{content.profile_pic}}"
                                    alt="프로필 사진"></a>

                            <a class="profile_id" id="user_id{{content.post_id}}"
                                href="{{url_for('profile_page', user_id=content.user_id)}}">{{content.user_id}}</a>
                        </div>
                        <div class="meatball_modal">
                            <button class="modal_button" data-toggle="modal" data-target="#modal_box1"><i
                                    class="fa fa-dots-three-horizontal" style="color: antiquewhite"></i></button>
                        </div>
                    </div>
                    <!--모달-->
                    <div class="modal" tabindex="-1" id="modal_box1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <p class="modal-title" style="color:#C7B0FFFF"><a href="">신고</a></p>
                                </div>
                                <div class="modal-header">
                                    <p class="modal-title" style="color:#C7B0FFFF"><a href="">팔로우 취소</a></p>
                                </div>
                                <div class="modal-header">
                                    <p class="modal-title"><a href="">게시물로 이동</a></p>
                                </div>
                                <div class="modal-header">
                                    <p class="modal-title"><a href="">공유 대상...</a></p>
                                </div>
                                <div class="modal-header">
                                    <p class="modal-title"><a href="">링크 복사</a></p>
                                </div>
                                <div class="modal-header">
                                    <p class="modal-title"><a href="">퍼가기</a></p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="modal_dismiss_button" data-dismiss="modal">취소</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--캐러셀-->
                    <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner">
                            <div class="carousel-item active">
                                <img class="d-block w-100" src="/static/img/post_contents/{{content.f_name}}"
                                    alt="First slide">
                            </div>
                            <div class="carousel-item">
                                <img class="d-block w-100" src="/static/img/post_contents/{{content.f_name}}"
                                    alt="Second slide">
                            </div>
                            <div class="carousel-item">
                                <img class="d-block w-100" src="/static/img/post_contents/{{content.f_name}}"
                                    alt="Third slide">
                            </div>
                        </div>
                        <a class="carousel-control-prev" href="#carouselExampleControls" role="button"
                            data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#carouselExampleControls" role="button"
                            data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                    <!--카드 바디-->
                    <div class="card_body">
                        <div class="icon_bar">
                            <div class="icon_bar_left">
                                <div id="like-heart{{content.post_id}}" style="display: block;">
                                    <button onclick="like_up('{{content.post_id}}')"><i
                                            class="fa fa-heart"></i></button>
                                </div>
                                <div id="liked-heart{{content.post_id}}" style="display: none;">
                                    <button onclick="like_cancel('{{content.post_id}}')"><i class="fa fa-heart"
                                            style="color:red;"></i></button>
                                </div>
                                <div>
                                    <button><i class="fa fa-chat-bubble" data-toggle="modal"
                                            data-target="#modal_card{{content.post_id}}"></i></button>
                                </div>
                                <div>
                                    <button><i class="fa fa-paper-plane"></i></button>
                                </div>
                            </div>
                            <div class="icon_bar_right">
                                <button id="bookmark{{content.post_id}}" class="bookmark"><i class="fa fa-bookmark"
                                        aria-hidden="true"></i></button>
                            </div>
                        </div>
                        <div class="card-text">
                            <p id="counter-text1"><span id="counter-click1" class="counter-click"
                                    name="{{content.post_id}}">0</span>명이 좋아합니다.</p>
                            <a href="{{url_for('profile_page', user_id=content.user_id)}}" alt="계정"
                                name="{{content.post_id}}">{{content.user_id}}</a>
                            <span id="shown_desc{{content.post_id}}" class="card_comment">{{content.desc}}</span>
                            <button id="desc_read_more_button{{content.post_id}}" class="more_button"
                                onclick="desc_read_more('{{content.post_id}}')">더 보기</button>
                            <span id="hidden_desc{{content.post_id}}" class="card_comment">{{content.desc}}</span>
                            <br>
                            <button id="comment_box{{content.post_id}}" class="comment_box" data-toggle="modal"
                                data-target="#modal_card{{content.post_id}}">댓글 00개 모두
                                보기
                            </button>

                            <div id="comment_lists{{content.post_id}}" class="comment-list">
                            </div>
                            <p id="timestamp{{content.post_id}}" class="time_passed">00시간 전</p>
                        </div>
                        <div class="card_bottom">
                            <input class="form-control" placeholder="댓글 달기..."
                                style="background-color: black; border: 3px solid black"
                                id="comment_input{{content.post_id}}">
                            <button class="comment_upload_button"
                                onclick="save_comment('{{content.post_id}}')">게시</button>
                        </div>
                    </div>
                    <!--댓글 상세 모달-->
                    <div class="modal" tabindex="-1" id="modal_card{{content.post_id}}"
                        style="padding-right: 16px; display: none;">
                        <div class="modal-dialog1">
                            <div class="modal-content1">
                                <div id="carouselExampleControls2">
                                    <div class="carousel-inner" style="margin-top: auto; margin-bottom: auto;">
                                        <div class="carousel-item">
                                            <img class="d-block w-100"
                                                src="/static/img/post_contents/{{content.f_name}}" alt="First slide">
                                        </div>
                                        <div class="carousel-item">
                                            <img class="d-block w-100"
                                                src="/static/img/post_contents/{{content.f_name}}" alt="Second slide">
                                        </div>
                                        <div class="carousel-item active">
                                            <img class="d-block w-100"
                                                src="/static/img/post_contents/{{content.f_name}}" alt="Third slide">
                                        </div>
                                    </div>
                                    <a class="carousel-control-prev" href="#carouselExampleControls2" role="button"
                                        data-slide="prev">
                                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                    <a class="carousel-control-next" href="#carouselExampleControls2" role="button"
                                        data-slide="next">
                                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </div>
                            </div>
                            <div class="modal-content2">
                                <div class="modal-top-line">
                                    <div class="profile">
                                        <a class="profile_pic_box" style="margin-left:15px;"
                                            href="{{url_for('profile_page', user_id=content.user_id)}}"><img
                                                class="profile_pic" src="../static/img/profiles/{{content.user_id}}.jpg"
                                                alt="프로필 사진"></a>
                                        <a href="/profile_page" style="margin-left:15px;">{{content.user_id}}</a>
                                    </div>
                                </div>
                                <div class="modal-body">
                                    <div id="comment-desc" style="margin-bottom: 10px;">
                                        <a href="/profile_page" alt="계정"
                                            name="{{content.post_id}}">{{content.user_id}}</a>
                                        <span>{{content.desc}}</span>
                                    </div>
                                    <div id="modal_comment_lists{{content.post_id}}" class="comment-list">
                                    </div>
                                    <div class="icon_bar" style="margin-top: auto;">
                                        <div class="icon_bar_left">
                                            <div id="modal-like-heart{{content.post_id}}" style="display: block;">
                                                <button onclick="like_up('{{content.post_id}}')"><i
                                                        class="fa fa-heart"></i></button>
                                            </div>
                                            <div id="modal-liked-heart{{content.post_id}}" style="display: none;">
                                                <button onclick="like_cancel('{{content.post_id}}')"><i class="fa fa-heart"
                                                        style="color:red;"></i></button>
                                            </div>
                                            <div>
                                                <button><i class="fa fa-chat-bubble" data-toggle="modal"
                                                        data-target="#modal_card{{content.post_id}}"></i></button>
                                            </div>
                                            <div>
                                                <button><i class="fa fa-paper-plane"></i></button>
                                            </div>
                                        </div>
                                        <div class="icon_bar_right">
                                            <button id="bookmark{{content.post_id}}" class="bookmark"><i
                                                    class="fa fa-bookmark" aria-hidden="true"></i></button>
                                        </div>
                                    </div>
                                    <div class="card-text">
                                        <p id="counter-text1"><span id="counter-click1" class="counter-click"
                                                name="{{content.post_id}}">0</span>명이 좋아합니다.</p>
                                    </div>
                                </div>
                                <div class="modal-comment">

                                    <input class="form-control" style="width: 82%; margin-left: 15px;"
                                        placeholder="댓글 달기..." id="modal_comment_input{{content.post_id}}" rows="">
                                    <button class="comment_upload_button"
                                        onclick="save_modal_comment('{{content.post_id}}')">게시</button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <!--================2.메인 카드 섹션 END===============-->

            <!--================3. 사이드 바 START=================-->
            <div class="side_column">
                <div class="my_name">
                    <a class="profile_pic_box" style="width: 70px; height: 70px; margin: 10px;"
                       href="{{ url_for('profile_page', user_id=my_info.username) }}"><img class="profile_pic"
                                                                                           style="width: 100%;"
                                                                                           src="../static/img/profiles/{{ my_info.profile_pic }}"></a>
                    <div class="my_profile">
                        <p><a href="{{ url_for('profile_page', user_id=my_info.username) }}">{{ my_info.username }}</a>
                        </p>
                        <p>my page</p>
                    </div>
                </div>
                <div class="name_list" style="width: 100%">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item" style="margin:0;padding:0;">
                            <div class="profile" >
                                <a href="{{ url_for('profile_page', user_id=r_user1.username) }}"><img class="profile_pic" src="{{ r_user1.profile_pic }}" alt="프사"></a>
                                <div class="d-flex flex-column bd-highlight mb-3">
                                    <div class="p-2" style="padding: 0px"><p class="profile_name" ><a href="{{ url_for('profile_page', user_id=r_user1.username) }}">{{ r_user1.username }}</a></p></div>
                                    <div class="p-2"><p class="description" style="color: #FFFFFF">{{ r_user1.profile_info }}</p></div>
                                </div>
                            </div>
                            <button type="button" class="follow_button"  onclick="alert('팔로우 하였습니다')" >팔로우</button>
                        </li>
                        <li class="list-group-item" style="margin:0;padding:0;">
                            <div class="profile" >
                                <a href="{{ url_for('profile_page', user_id=r_user2.username) }}"><img class="profile_pic" src="{{ r_user2.profile_pic }}" alt="프사"></a>
                                <div class="d-flex flex-column bd-highlight mb-3">
                                    <div class="p-2" style="padding: 0px"><p class="profile_name" ><a href="{{ url_for('profile_page', user_id=r_user2.username) }}">{{ r_user2.username }}</a></p></div>
                                    <div class="p-2"><p class="description" style="color: #FFFFFF">{{ r_user2.profile_info }}</p></div>
                                </div>
                            </div>
                            <button type="button" class="follow_button"  onclick="alert('팔로우 하였습니다')" >팔로우</button>

                        </li>
                        <li class="list-group-item" style="margin:0;padding:0;">
                            <div class="profile" >
                                <a href="{{ url_for('profile_page', user_id=r_user3.username) }}"><img class="profile_pic" src="{{ r_user3.profile_pic }}" alt="프사"></a>
                                <div class="d-flex flex-column bd-highlight mb-3">
                                    <div class="p-2" style="padding: 0px"><p class="profile_name" ><a href="{{ url_for('profile_page', user_id=r_user3.username) }}">{{ r_user3.username }}</a></p></div>
                                    <div class="p-2"><p class="description" style="color: #FFFFFF">{{ r_user3.profile_info }}</p></div>
                                </div>
                            </div>
                            <button type="button" class="follow_button"  onclick="alert('팔로우 하였습니다')" >팔로우</button>
                        </li>
                        <li class="list-group-item" style="margin:0;padding:0;">
                            <div class="profile" >
                                <a href="{{ url_for('profile_page', user_id=r_user4.username) }}"><img class="profile_pic" src="{{ r_user4.profile_pic }}" alt="프사"></a>
                                <div class="d-flex flex-column bd-highlight mb-3">
                                    <div class="p-2" style="padding: 0px"><p class="profile_name" ><a href="{{ url_for('profile_page', user_id=r_user4.username) }}">{{ r_user4.username }}</a></p></div>
                                    <div class="p-2"><p class="description" style="color: #FFFFFF">{{ r_user4.profile_info }}</p></div>
                                </div>
                            </div>
                            <button type="button" class="follow_button"  onclick="alert('팔로우 하였습니다')" >팔로우</button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </main>
    </div>
    <!--================3. 사이드 바 END==================-->

    <!--================4. FOOTER START==================-->
    <!-- <div class="footer">
    <ul class="footer-contents">
        <li><a href="">소개</a></li>
        <li>/</li>
        <li><a href="">블로그</a></li>
        <li>/</li>
        <li><a href="">채용정보</a></li>
        <li>/</li>
        <li><a href="">도움말</a></li>
        <li>/</li>
        <li><a href="">API</a></li>
        <li>/</li>
        <li><a href="">개인정보처리방침</a>
        <li>/</li>
        <li><a href="">약관</a></li>
        <li>/</li>
        <li><a href="">인기계정</a></li>
        <li>/</li>
        <li><a href="">해시태그</a></li>
    </ul>
    <div>
        <div>한국어 ©2022 Citistagram by Tasha</div>
    </div>
</div> -->
    <!--================4. FOOTER END====================-->

    <script>
        let files;

        $('#nav_bar_add_box').click(function () { //+버튼 클릭시 1번모달창 나타나기
            $('#first_modal').css({
                display: 'flex'
            });
            $(document.body).css({   //+버튼 클릭시 전체화면 스크롤바 사라짐
                overflow: 'hidden'
            })
        });
        $('#modal_x_box').click(function () {   //x버튼 클릭시 1번모달창 사라짐
            $('.modal_overlay').css({
                display: 'none'
            });
            $(document.body).css({
                overflow: 'visible'
            })
        });
        $('#modal_x_box2').click(function () {   //x버튼 클릭시 2번모달창 사라짐
            $('.modal_overlay').css({
                display: 'none'
            });
            $(document.body).css({
                overflow: 'visible'
            })
        });
        $('.addition_modal_body')    //모달창에 드래그앤 드롭 기능 구현하겠다
            .on("dragover", dragOver)
            .on("dragleave", dragOver)
            .on("drop", uploadFiles);

        function dragOver(e) {     //드래그오버 함수
            e.stopPropagation();   //드래그오버시 모달창만 반응하고 뒤의 페이즈는 반응하지 않음
            e.preventDefault();
            if (e.type == "dragover") {  //드래그오버하면 outline이 가운데로 몰림
                $(e.target).css({
                    "outline-offset": "-20px",
                    "border-radius": "8px"
                });
            } else {
                $(e.target).css({
                    "background-color": "black",
                    "outline-offset": "-10px"
                });
            }
        }

        function uploadFiles(e) {  //업로드파일 함수
            e.stopPropagation();  //업로드파일시 모달창만 반응하고 뒤의 페이즈는 반응하지 않음
            e.preventDefault();
            e.dataTransfer = e.originalEvent.dataTransfer;
            files = e.dataTransfer.files;
            if (files.length > 1) {    //파일갯수가 여러개면 하나만 올려주세요 창이 뜸
                alert('하나만 올려 주세요');
                return;
            }
            //파일이 이미지로 인식되면 배경 이미지 바뀌게 만듬
            if (files[0].type.match(/image.*/)) {
                $('#first_modal').css({
                    display: 'none'
                });
                $('#second_modal').css({
                    display: 'flex'
                });
                $('.img_upload_space').css({
                    "background-image": "url(" + window.URL.createObjectURL(files[0]) + ")",
                    "outline": "none",
                    "background-size": "100% 100%"
                });
            } else {
                alert('이미지가 아닙니다.');
            }
        }

        //파일 업로드 여기서부터 시작
        function uploading_files() {
            let file = files[0]; //실제 파일
            let image = files[0].name; //파일명
            let desc = $('#input_feed_content').val(); //이미지 밑에 쓴 글
            console.log(image)
            let formData = new FormData();
            formData.append('file_give', file)
            formData.append('image_give', image)
            formData.append('desc_give', desc)
            $.ajax({
                type: 'POST',
                url: '/content',
                processData: false,
                contentType: false,
                data: formData,
                success: function (response) {
                    if (response['result'] == 'success') {
                        alert(response['msg'])
                        window.location.href = '/'
                    } else {
                        alert(response['msg'])
                        window.location.reload()
                    }
                },
                error: function (err) {
                    console.log('error:' + err)
                }
            });
        }
    </script>
    <script type="text/javascript" src="../static/script.js"></script>
</body>

</html>